<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link rel="stylesheet" href="reset.css" />
    <style>
      form {
        background-color: #0f172a;

        border-radius: 2rem;
        position: relative;
      }

      #info {
        display: block;
        color: white;
        margin-bottom: 2rem;
      }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="grid place-items-center min-h-screen bg-slate-700">
    <form id="form" class="p-12">
      <span id="info"> Please enter a file that follows a supported format! </span>
      <div class="relative flex w-full max-w-sm flex-col gap-1 text-slate-700 dark:text-slate-300">
        <!-- <label for="fileInput" class="w-fit pl-0.5 text-sm">Upload File</label> -->
        <input
          name="fileInput"
          id="fileInput"
          type="file"
          class="w-full max-w-md overflow-clip rounded-xl border border-slate-300 bg-slate-100/50 text-sm file:mr-4 file:cursor-pointer file:border-none file:bg-slate-100 file:px-4 file:py-2 file:font-medium file:text-black focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-700 disabled:cursor-not-allowed disabled:opacity-75 dark:border-slate-700 dark:bg-slate-800/50 dark:file:bg-slate-800 dark:file:text-white dark:focus-visible:outline-blue-600"
        />
        <!-- <small class="pl-0.75">Excel, CSV</small> -->
      </div>

      <button
        type="submit"
        id="submit"
        class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-indigo-500 hover:bg-indigo-400 transition ease-in-out duration-150 mt-4 float-right"
      >
        <svg
          class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          id="spinner"
          style="display: none"
        >
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
        <span id="button-text">Submit</span>
      </button>
    </form>
    <script defer>
      const button = document.getElementById("submit");
      const fileInput = document.getElementById("fileInput");
      const spinner = document.getElementById("spinner");
      const buttonText = document.getElementById("button-text");
      const form = document.getElementById("form");

      button.addEventListener("click", async (e) => {
        e.preventDefault();

        buttonText.innerHTML = "Processing...";
        button.classList.add("cursor-not-allowed");
        fileInput.classList.add("cursor-not-allowed");
        button.classList.replace("bg-indigo-500", "bg-indigo-400");
        spinner.style.display = "block";

        const resp = await fetch("/request", {
          body: new FormData(form),
          method: "POST",
        });

        if (!resp.ok) {
          alert(await resp.text());
        } else {
          const blob = await resp.blob();
          const file = window.URL.createObjectURL(blob);
          window.location.assign(file);
        }

        buttonText.innerHTML = "Submit";
        button.classList.remove("cursor-not-allowed");
        fileInput.classList.remove("cursor-not-allowed");
        button.classList.replace("bg-indigo-400", "bg-indigo-500");
        spinner.style.display = "none";
      });
    </script>
  </body>
</html>
